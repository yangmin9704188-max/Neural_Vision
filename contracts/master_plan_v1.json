{
  "schema_version": "master_plan.v1",
  "updated_at": "2026-02-08T02:00:00+09:00",

  "principles": {
    "enforcement": "warn-only",
    "no_fail": true,
    "ssot": "this file (contracts/master_plan_v1.json)"
  },

  "agents": {
    "body_llm": { "label": "Body LLM" },
    "fitting_llm": { "label": "Fitting LLM" },
    "garment_llm": { "label": "Garment LLM" }
  },

  "artifacts": {
    "body_subset_m0": {
      "label": "body_measurements_subset.json (M0)",
      "path_glob_any": [
        "exports/runs/*/*/body_measurements_subset.json",
        "exports/runs/*/*/*/body_measurements_subset.json"
      ]
    },
    "garment_proxy_meta_m0": {
      "label": "garment_proxy_meta.json (M0)",
      "path_glob_any": [
        "exports/runs/*/*/garment_proxy_meta.json",
        "exports/runs/*/*/*/garment_proxy_meta.json"
      ]
    },
    "geometry_manifest_root": {
      "label": "geometry_manifest.json (run 루트)",
      "path_glob_any": [
        "exports/runs/*/*/geometry_manifest.json"
      ]
    },
    "facts_summary_root": {
      "label": "facts_summary.json (run 루트)",
      "path_glob_any": [
        "exports/runs/*/*/facts_summary.json"
      ]
    }
  },

  "maturity_levels": {
    "M0": {
      "label": "M0 (stub 허용)",
      "checks": [
        {
          "check_id": "run_minset_present",
          "type": "run_minset",
          "min_count": 2,
          "files_any": ["geometry_manifest.json", "facts_summary.json", "RUN_README.md"],
          "severity": "warn"
        }
      ]
    },
    "M1": {
      "label": "M1 (정합성 최소)",
      "checks": [
        {
          "check_id": "manifest_has_fp_or_inputs_fp",
          "type": "json_fields_any",
          "path": "geometry_manifest.json",
          "fields_any": ["fingerprint", "inputs_fingerprint"],
          "severity": "warn"
        }
      ]
    },
    "M2": {
      "label": "M2 (KPI 기반)",
      "checks": [
        {
          "check_id": "kpi_present",
          "type": "file_exists",
          "path": "kpi.json",
          "severity": "warn"
        }
      ]
    }
  },

  "plan_items": [
    {
      "plan_id": "P0.body.emit_subset_m0",
      "module": "body",
      "title": "Body: body_measurements_subset.json (M0) 생성",
      "status_hint": "In progress",
      "unlock_target": "U1",
      "maturity_target": "M0",
      "target_agent": "body_llm",
      "done_when": {
        "type": "artifact_observed",
        "artifact_id": "body_subset_m0"
      }
    },
    {
      "plan_id": "P0.garment.emit_proxy_meta_m0",
      "module": "garment",
      "title": "Garment: garment_proxy_meta.json (M0) 생성",
      "status_hint": "In progress",
      "unlock_target": "U1",
      "maturity_target": "M0",
      "target_agent": "garment_llm",
      "done_when": {
        "type": "artifact_observed",
        "artifact_id": "garment_proxy_meta_m0"
      }
    },
    {
      "plan_id": "P0.fitting.u1_ready",
      "module": "fitting",
      "title": "Fitting: U1 입력 준비 완료",
      "status_hint": "Todo",
      "unlock_target": "U1",
      "maturity_target": "M0",
      "target_agent": "fitting_llm",
      "done_when": {
        "type": "and",
        "items": [
          { "type": "artifact_observed", "artifact_id": "body_subset_m0" },
          { "type": "artifact_observed", "artifact_id": "garment_proxy_meta_m0" }
        ]
      }
    }
  ],

  "unlocks": [
    {
      "unlock_id": "U1.FITTING_READY",
      "title": "✅ [FITTING] U1 언락: 입력 준비 완료",
      "logic": {
        "type": "and",
        "items": [
          { "type": "artifact_observed", "artifact_id": "body_subset_m0" },
          { "type": "artifact_observed", "artifact_id": "garment_proxy_meta_m0" }
        ]
      },
      "on_unlocked": {
        "target_agent": "fitting_llm",
        "brief_id": "LLM_SYNC_FITTING_U1_READY",
        "brief_path": "exports/brief/LLM_SYNC_FITTING_U1_READY.txt",
        "template_ko": [
          "현재 상황: Body에서 body_measurements_subset.json(M0)이 관측되었습니다.",
          "현재 상황: Garment에서 garment_proxy_meta.json(M0)이 관측되었습니다.",
          "언락 소식: 이로 인해 Fitting의 U1 입력 준비가 완료되었습니다. (unlock_id=U1.FITTING_READY)",
          "",
          "다음 지시(바로 할 일):",
          "1) Fitting 모듈에서 U1 입력 검증(strict-run, warn-only)을 실행/보강하세요.",
          "2) ROUND_END 시 evidence_paths에 run_minset(geometry_manifest/facts_summary/RUN_README)을 반드시 포함시키세요.",
          "3) 결과를 PROGRESS_LOG.jsonl에 ROUND_END로 남기고, 새 run_dir 루트에 minset 3종이 존재하도록 보장하세요."
        ]
      },
      "dashboard_pin": true
    }
  ],

  "dashboard": {
    "title": "Neural Vision Dashboard",
    "top_sections": ["newly_unlocked", "blockers", "next_actions", "modules"],
    "limits": { "newly_unlocked": 10, "blockers": 10, "next_actions_per_module": 3 }
  }
}
