{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "geometry_manifest_v1",
  "title": "geometry_manifest.v1",
  "description": "Canonical geometry manifest schema for Body/Garment/Fitting run outputs",
  "type": "object",
  "required": [
    "schema_version",
    "module_name",
    "contract_version",
    "created_at",
    "inputs_fingerprint",
    "version_keys",
    "artifacts"
  ],
  "additionalProperties": true,
  "properties": {
    "schema_version": {
      "const": "geometry_manifest.v1",
      "description": "Schema identifier"
    },
    "module_name": {
      "enum": ["body", "fitting", "garment"],
      "description": "Module that produced this manifest"
    },
    "contract_version": {
      "type": "string",
      "description": "Module contract version string"
    },
    "created_at": {
      "type": "string",
      "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z$",
      "description": "UTC timestamp, seconds only (no milliseconds)"
    },
    "inputs_fingerprint": {
      "type": "string",
      "description": "Deterministic fingerprint of inputs (excludes created_at)"
    },
    "version_keys": {
      "type": "object",
      "required": [
        "snapshot_version",
        "semantic_version",
        "geometry_impl_version",
        "dataset_version"
      ],
      "additionalProperties": true,
      "properties": {
        "snapshot_version": { "type": "string" },
        "semantic_version": { "type": "string" },
        "geometry_impl_version": { "type": "string" },
        "dataset_version": { "type": "string" }
      }
    },
    "artifacts": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^(?!\\/)(?!^[A-Za-z]:)(?!.*\\.\\.).+$",
        "description": "Relative path: no leading /, no drive letters, no .."
      },
      "description": "Run-dir-relative artifact paths"
    },
    "warnings": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Optional inline warnings"
    },
    "warnings_path": {
      "type": "string",
      "pattern": "^(?!\\/)(?!^[A-Za-z]:)(?!.*\\.\\.).+$",
      "description": "Optional relative path to warnings file"
    },
    "provenance_path": {
      "type": "string",
      "pattern": "^(?!\\/)(?!^[A-Za-z]:)(?!.*\\.\\.).+$",
      "description": "Optional relative path to provenance"
    }
  }
}
