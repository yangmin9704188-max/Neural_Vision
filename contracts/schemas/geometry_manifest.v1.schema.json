{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "geometry_manifest.v1",
  "title": "geometry_manifest.v1 — U1 Freeze",
  "description": "Canonical schema for geometry_manifest.json (Body/Garment/Fitting). Ref: unlock_conditions_u1_u2.md §1.1",
  "type": "object",
  "required": [
    "schema_version",
    "module_name",
    "contract_version",
    "created_at",
    "inputs_fingerprint",
    "version_keys",
    "artifacts"
  ],
  "additionalProperties": true,
  "properties": {
    "schema_version": {
      "const": "geometry_manifest.v1",
      "description": "Must be exactly 'geometry_manifest.v1'"
    },
    "module_name": {
      "enum": ["body", "fitting", "garment"],
      "description": "Module that produced this manifest"
    },
    "contract_version": {
      "type": "string",
      "minLength": 1,
      "description": "Module contract version string (non-empty)"
    },
    "created_at": {
      "type": "string",
      "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z$",
      "description": "UTC timestamp YYYY-MM-DDTHH:MM:SSZ — no milliseconds (Freeze §1.1.2)"
    },
    "inputs_fingerprint": {
      "type": "string",
      "minLength": 1,
      "description": "Deterministic SHA-256 fingerprint (excludes created_at)"
    },
    "version_keys": {
      "type": "object",
      "required": [
        "snapshot_version",
        "semantic_version",
        "geometry_impl_version",
        "dataset_version"
      ],
      "additionalProperties": true,
      "properties": {
        "snapshot_version": { "type": "string", "minLength": 1 },
        "semantic_version": { "type": "string", "minLength": 1 },
        "geometry_impl_version": { "type": "string", "minLength": 1 },
        "dataset_version": { "type": "string", "minLength": 1 }
      },
      "description": "4 version keys required; null/empty forbidden; use 'UNSPECIFIED' + warning (§1.1.4)"
    },
    "artifacts": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 1
      },
      "description": "Run-dir-relative artifact paths only (§1.1.5)"
    },
    "warnings": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Optional inline warnings"
    },
    "warnings_path": {
      "type": "string",
      "description": "Optional relative path to warnings file"
    },
    "provenance_path": {
      "type": "string",
      "description": "Optional relative path to provenance"
    }
  }
}
