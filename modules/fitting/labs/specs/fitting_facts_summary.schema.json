{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "specs/fitting_facts_summary.schema.json",
  "title": "Fitting Facts Summary Schema v1",
  "description": "Facts-only fitting run summary. No quality PASS/FAIL thresholds. Contract: contracts/fitting_interface_v0.md.",
  "type": "object",
  "required": [
    "schema_version",
    "garment_input_path_used",
    "early_exit",
    "early_exit_reason",
    "degraded_state",
    "warnings_summary"
  ],
  "additionalProperties": false,
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "fitting_facts_summary.v1",
      "description": "Schema version (fixed v1)."
    },
    "garment_input_path_used": {
      "type": "string",
      "enum": ["npz", "glb_fallback"],
      "description": "Which garment source was used: npz primary or glb+meta fallback."
    },
    "early_exit": {
      "type": "boolean",
      "description": "True if run ended by early exit (e.g. hard gate)."
    },
    "early_exit_reason": {
      "type": ["string", "null"],
      "description": "Reason code or message when early_exit is true; null otherwise."
    },
    "degraded_state": {
      "description": "Records causes of missing/partial failure. Object (key-value) or array of entries.",
      "oneOf": [
        {
          "type": "object",
          "additionalProperties": true,
          "minProperties": 0
        },
        {
          "type": "array",
          "items": {}
        }
      ]
    },
    "warnings_summary": {
      "type": "object",
      "description": "Per-code summary: CODE -> { count, sample_messages (<=5), truncated }.",
      "additionalProperties": {
        "type": "object",
        "required": ["count", "sample_messages", "truncated"],
        "additionalProperties": false,
        "properties": {
          "count": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of occurrences for this code."
          },
          "sample_messages": {
            "type": "array",
            "maxItems": 5,
            "items": { "type": "string" },
            "description": "At most 5 sample messages."
          },
          "truncated": {
            "type": "boolean",
            "description": "True if more messages exist beyond sample_messages."
          }
        }
      }
    }
  }
}
