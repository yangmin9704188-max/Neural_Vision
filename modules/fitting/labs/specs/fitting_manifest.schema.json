{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "specs/fitting_manifest.schema.json",
  "title": "Fitting Manifest Schema v1",
  "description": "Fitting run manifest v1. All lengths/distances in meters (m). Artifact paths must be relative to run root. Fingerprint is input-based only (created_at excluded).",
  "type": "object",
  "required": [
    "schema_version",
    "contract_version",
    "created_at",
    "inputs_fingerprint",
    "input_manifests",
    "limits",
    "camera",
    "outputs"
  ],
  "additionalProperties": false,
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "fitting_manifest.v1",
      "description": "Schema version identifier (fixed v1)."
    },
    "contract_version": {
      "type": "string",
      "minLength": 1,
      "description": "Contract version (e.g. contract.v1, sizekorea_v2)."
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "Creation timestamp (ISO 8601). Not used in inputs_fingerprint."
    },
    "inputs_fingerprint": {
      "type": "string",
      "pattern": "^[a-fA-F0-9]+$",
      "minLength": 32,
      "maxLength": 128,
      "description": "Deterministic fingerprint of inputs only (hex). Excludes created_at. Use fingerprint_algo to declare algorithm."
    },
    "fingerprint_algo": {
      "type": "string",
      "enum": ["sha256", "sha384", "sha512"],
      "description": "Algorithm used to compute inputs_fingerprint. Confirms fingerprint is input-based."
    },
    "version_keys": {
      "type": "object",
      "description": "Version identifiers. Use 'UNSPECIFIED' when unknown; validator may emit warnings.",
      "additionalProperties": false,
      "properties": {
        "snapshot_version": { "type": "string", "description": "Point-in-time snapshot. Use UNSPECIFIED if unknown." },
        "semantic_version": { "type": "string", "description": "Semantic version. Use UNSPECIFIED if unknown." },
        "geometry_impl_version": { "type": "string", "description": "Geometry impl version. Use UNSPECIFIED if unknown." },
        "dataset_version": { "type": "string", "description": "Dataset version. Use UNSPECIFIED if unknown." }
      }
    },
    "input_manifests": {
      "type": "object",
      "required": ["body_manifest_path", "garment_manifest_path"],
      "additionalProperties": false,
      "properties": {
        "body_manifest_path": {
          "type": "string",
          "minLength": 1,
          "description": "Relative path to body geometry_manifest.json (run root)."
        },
        "garment_manifest_path": {
          "type": "string",
          "minLength": 1,
          "description": "Relative path to garment geometry_manifest.json (run root)."
        }
      }
    },
    "limits": {
      "type": "object",
      "required": ["max_retry", "iter_max_per_attempt"],
      "additionalProperties": false,
      "properties": {
        "max_retry": {
          "type": "integer",
          "const": 2,
          "description": "Max retry attempts (fixed contract value)."
        },
        "iter_max_per_attempt": {
          "type": "integer",
          "const": 100,
          "description": "Max iterations per attempt (fixed contract value)."
        }
      }
    },
    "camera": {
      "type": "object",
      "required": ["camera_preset_id", "params"],
      "additionalProperties": false,
      "properties": {
        "camera_preset_id": {
          "type": "string",
          "const": "fixed_camera_preset_v1",
          "description": "Camera preset identifier."
        },
        "params": {
          "type": "object",
          "required": [
            "fov_deg",
            "camera_distance_m",
            "yaw_deg",
            "pitch_deg",
            "roll_deg",
            "near_m",
            "far_m",
            "image_resolution_w",
            "image_resolution_h"
          ],
          "additionalProperties": false,
          "properties": {
            "fov_deg": { "type": "number", "description": "Field of view (degrees)." },
            "camera_distance_m": { "type": "number", "minimum": 0, "description": "Camera distance in meters." },
            "yaw_deg": { "type": "number", "description": "Yaw (degrees)." },
            "pitch_deg": { "type": "number", "description": "Pitch (degrees)." },
            "roll_deg": { "type": "number", "description": "Roll (degrees)." },
            "near_m": { "type": "number", "minimum": 0, "description": "Near plane (meters)." },
            "far_m": { "type": "number", "minimum": 0, "description": "Far plane (meters)." },
            "image_resolution_w": { "type": "integer", "minimum": 1, "description": "Image width (px)." },
            "image_resolution_h": { "type": "integer", "minimum": 1, "description": "Image height (px)." }
          }
        }
      }
    },
    "outputs": {
      "type": "object",
      "required": ["geometry_manifest_path", "fitting_facts_summary_path"],
      "additionalProperties": false,
      "properties": {
        "geometry_manifest_path": {
          "type": "string",
          "minLength": 1,
          "description": "Relative path to fitting output geometry_manifest.json (run root)."
        },
        "fitting_facts_summary_path": {
          "type": "string",
          "minLength": 1,
          "description": "Relative path to fitting facts summary (run root)."
        },
        "fit_signal_path": { "type": "string", "minLength": 1, "description": "Optional fit signal path (relative)." },
        "fitted_proxy_path": { "type": "string", "minLength": 1, "description": "Optional fitted proxy path (relative)." },
        "condition_images_dir": { "type": "string", "minLength": 1, "description": "Optional condition images dir (relative)." },
        "provenance_path": { "type": "string", "minLength": 1, "description": "Optional provenance path (relative)." }
      }
    },
    "warnings": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["code", "severity", "message"],
        "additionalProperties": false,
        "properties": {
          "code": { "type": "string" },
          "severity": { "type": "string", "enum": ["info", "warning", "error"] },
          "message": { "type": "string" }
        }
      },
      "description": "Optional warnings from manifest producer."
    }
  }
}
